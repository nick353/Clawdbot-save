# ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ã‚¯ãƒ©ãƒƒã‚·ãƒ¥åŸå› èª¿æŸ»

## ğŸ”´ **å•é¡Œã®æ¦‚è¦**

ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ãŒäºˆæœŸã›ãšåœæ­¢ã™ã‚‹ï¼ˆç´„35åˆ†ã”ã¨ã«1å›ï¼‰ï¼š
- 09:10:01 åœæ­¢ï¼ˆæ‰‹å‹•ä¿®æ­£æ™‚ï¼‰
- **09:41:30 åœæ­¢**ï¼ˆåŸå› ä¸æ˜ï¼‰

## ğŸ“Š **èª¿æŸ»çµæœ**

### åœæ­¢æ™‚åˆ»ã®åˆ†æ

**ãƒã‚§ãƒƒã‚¯#30ï¼ˆ09:41:30ï¼‰ã§åœæ­¢ï¼š**
```
ğŸ”„ ãƒã‚§ãƒƒã‚¯ #30 - 2026-02-14 09:41:30
ğŸ’° ç¾åœ¨è³‡é‡‘: $8,000.00 | ãƒã‚¸ã‚·ãƒ§ãƒ³: 1
ï¼ˆã“ã“ã§åœæ­¢ - "â±ï¸ æ¬¡ã®ãƒã‚§ãƒƒã‚¯..." ãŒå‡ºåŠ›ã•ã‚Œãªã‹ã£ãŸï¼‰
```

### ã‚³ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

```python
while True:
    iteration += 1
    print(f"ğŸ”„ ãƒã‚§ãƒƒã‚¯ #{iteration}...")  # âœ… å‡ºåŠ›ã•ã‚ŒãŸ
    print(f"ğŸ’° ç¾åœ¨è³‡é‡‘...")              # âœ… å‡ºåŠ›ã•ã‚ŒãŸ
    
    try:
        self.run_iteration()               # âœ… å®Ÿè¡Œã•ã‚ŒãŸï¼ˆã‚¨ãƒ©ãƒ¼ãªã—ï¼‰
    except Exception as e:
        print(f"âŒ ãƒã‚§ãƒƒã‚¯å¤±æ•—...")       # âŒ å‡ºåŠ›ã•ã‚Œã¦ã„ãªã„
    
    # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆ5å›ã«1å›ï¼‰
    if iteration % 5 == 0:
        self.health_check()                # âš ï¸ ã“ã“ã§åœæ­¢ï¼Ÿ
    
    print(f"â±ï¸ æ¬¡ã®ãƒã‚§ãƒƒã‚¯...")           # âŒ å‡ºåŠ›ã•ã‚Œãªã‹ã£ãŸ
```

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã®å†…å®¹

```python
def health_check(self):
    try:
        # ãƒ¡ãƒ¢ãƒªãƒã‚§ãƒƒã‚¯ï¼ˆpsutilï¼‰
        process = psutil.Process()
        mem_percent = process.memory_percent()
        if mem_percent > 80:
            gc.collect()
        
        # ãƒã‚¸ã‚·ãƒ§ãƒ³æ°¸ç¶šåŒ–
        if len(self.positions) > 0:
            self.save_positions()  # â† ã“ã“ã§åœæ­¢ï¼Ÿ
    
    except Exception as e:
        print(f"âš ï¸ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: {e}")  # â† å‡ºåŠ›ã•ã‚Œã¦ã„ãªã„
```

### é™¤å¤–ã•ã‚ŒãŸåŸå› 

âŒ **ãƒ¡ãƒ¢ãƒªä¸è¶³ï¼ˆOOMï¼‰**
- Total: 1.9GB, Used: 745MB, Available: 1.2GB
- ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼: 166.6MBï¼ˆ8.4%ï¼‰
- dmesgã«OOMãƒ­ã‚°ãªã—

âŒ **ä¾‹å¤–ã‚¨ãƒ©ãƒ¼**
- try-exceptã§å›²ã¾ã‚Œã¦ã„ã‚‹ãŒã€ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãªã—
- ãƒ­ã‚°ã« "Exception", "Error", "Traceback" ãªã—

âŒ **SIGTERMï¼ˆé€šå¸¸ã®ã‚·ã‚°ãƒŠãƒ«ï¼‰**
- ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã®ãƒ­ã‚°ãŒãªã„
- signal_handlerãŒåå¿œã—ã¦ã„ãªã„

âŒ **cronç­‰ã«ã‚ˆã‚‹åœæ­¢**
- 09:41:30ã«cronã‚¸ãƒ§ãƒ–ãªã—
- watchdogã¯5åˆ†ã”ã¨ï¼ˆ09:40, 09:45ï¼‰

âœ… **å¯èƒ½æ€§ã®é«˜ã„åŸå› **

1. **SIGKILLï¼ˆå¼·åˆ¶çµ‚äº†ï¼‰**
   - ãƒ­ã‚°ã«ä½•ã‚‚æ®‹ã‚‰ãªã„
   - å¤–éƒ¨ã‹ã‚‰ã®å¼·åˆ¶çµ‚äº†
   - åŸå› : ä¸æ˜ï¼ˆã‚·ã‚¹ãƒ†ãƒ ï¼Ÿä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ï¼Ÿï¼‰

2. **Pythonã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ã®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆã‚»ã‚°ãƒ•ã‚©ãƒ«ãƒˆï¼‰**
   - psutil.Process()ã®ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹
   - ãƒ•ã‚¡ã‚¤ãƒ«I/Oä¸­ã®ã‚«ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã‚¨ãƒ©ãƒ¼
   - ã‚³ã‚¢ãƒ€ãƒ³ãƒ—: ç¢ºèªã§ããšï¼ˆulimit -c = 0ï¼‰

3. **KVMä»®æƒ³åŒ–ç’°å¢ƒã®å•é¡Œ**
   - ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã®ä¸€æ™‚åœæ­¢
   - ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
   - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

4. **ãƒ•ã‚¡ã‚¤ãƒ«I/Oã®ãƒ–ãƒ­ãƒƒã‚¯**
   - `self.save_positions()` ä¸­ã«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒƒã‚¯
   - NFSã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆè©²å½“ãªã—ï¼‰
   - ãƒ‡ã‚£ã‚¹ã‚¯I/Oé…å»¶

## ğŸ› ï¸ **æ¨å¥¨å¯¾ç­–**

### 1. è©³ç´°ãƒ­ã‚®ãƒ³ã‚°è¿½åŠ 

```python
def health_check(self):
    try:
        print(f"ğŸ¥ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯é–‹å§‹", flush=True)
        
        # ãƒ¡ãƒ¢ãƒªãƒã‚§ãƒƒã‚¯
        print(f"  ğŸ“Š ãƒ¡ãƒ¢ãƒªãƒã‚§ãƒƒã‚¯ä¸­...", flush=True)
        try:
            import psutil
            process = psutil.Process()
            mem_percent = process.memory_percent()
            print(f"  âœ… ãƒ¡ãƒ¢ãƒª: {mem_percent:.1f}%", flush=True)
            
            if mem_percent > 80:
                print(f"  ğŸ§¹ GCå®Ÿè¡Œä¸­...", flush=True)
                gc.collect()
                print(f"  âœ… GCå®Œäº†", flush=True)
        except ImportError:
            pass
        
        # ãƒã‚¸ã‚·ãƒ§ãƒ³ä¿å­˜
        if len(self.positions) > 0:
            print(f"  ğŸ’¾ ãƒã‚¸ã‚·ãƒ§ãƒ³ä¿å­˜ä¸­...", flush=True)
            self.save_positions()
            print(f"  âœ… ãƒã‚¸ã‚·ãƒ§ãƒ³ä¿å­˜å®Œäº†", flush=True)
        
        print(f"ğŸ¥ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Œäº†", flush=True)
    
    except Exception as e:
        print(f"âš ï¸ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: {e}", flush=True)
        import traceback
        print(f"ãƒˆãƒ¬ãƒ¼ã‚¹ãƒãƒƒã‚¯:\n{traceback.format_exc()}", flush=True)
```

### 2. ã‚³ã‚¢ãƒ€ãƒ³ãƒ—æœ‰åŠ¹åŒ–

```bash
# /etc/security/limits.conf ã«è¿½åŠ 
* soft core unlimited
* hard core unlimited

# å†èµ·å‹•å¾Œã€ulimit -c unlimited ã‚’ç¢ºèª
```

### 3. strace ã§ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ç›£è¦–

```bash
strace -f -o /root/clawd/data/trader-strace.log \
  python3 -u /root/clawd/scripts/bitget-trader-v2.py
```

### 4. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯é »åº¦ã®å¤‰æ›´

```python
# 5å›ã«1å› â†’ 10å›ã«1å›
if iteration % 10 == 0:
    self.health_check()
```

### 5. ãƒã‚¸ã‚·ãƒ§ãƒ³ä¿å­˜ã®éåŒæœŸåŒ–

```python
# save_positions() ã‚’åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œ
import threading

def save_positions_async(self):
    thread = threading.Thread(target=self.save_positions)
    thread.daemon = True
    thread.start()
```

### 6. watchdogé »åº¦ã®çŸ­ç¸®

```bash
# cron: 5åˆ† â†’ 2åˆ†
*/2 * * * * /bin/bash /root/clawd/scripts/watchdog-bitget-trader.sh
```

## ğŸ“ **æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**

1. âœ… è©³ç´°ãƒ­ã‚®ãƒ³ã‚°è¿½åŠ ï¼ˆæœ€å„ªå…ˆï¼‰
2. â³ æ¬¡å›ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚’å¾…ã£ã¦è¿½åŠ ãƒ­ã‚°ã‚’ç¢ºèª
3. â³ ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¦‹ã¤ã‹ã‚Œã°æ ¹æœ¬å¯¾ç­–

## ğŸ” **ç›£è¦–é …ç›®**

- ã‚¯ãƒ©ãƒƒã‚·ãƒ¥æ™‚åˆ»ã®è¦å‰‡æ€§ï¼ˆ35åˆ†ã”ã¨ï¼Ÿï¼‰
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ™‚ã®æŒ™å‹•
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æ¨ç§»
- ãƒ•ã‚¡ã‚¤ãƒ«I/Oé…å»¶
