# 運用方針（POLICY）

## 自動承認モード

**設定日:** 2026-02-13  
**承認者:** andoさん

---

## 基本方針

**全ての修正・変更は事前承認済み**

- 問題を検出したら、承認を待たずに即座に修正を実行
- 「承認しますか？」などの確認は不要
- 実行前・実行後の報告は継続（Discord通知）

---

## 適用範囲

### ✅ 自動実行可能な操作

1. **コード修正**
   - バグ修正
   - パフォーマンス改善
   - エラーハンドリング追加
   - タイムアウト調整

2. **設定変更**
   - パラメータ最適化
   - 監視銘柄の更新
   - リスク設定の調整

3. **システム管理**
   - プロセス再起動
   - ログローテーション
   - メモリ最適化

4. **機能追加**
   - 堅牢化・安定化
   - 自動化の拡充
   - 監視機能の強化

### ⚠️ 報告が必要な操作

以下は実行後に報告：
- 重要なコード変更
- アーキテクチャ変更
- 外部サービス連携変更
- トレード戦略の変更

### ❌ 禁止事項

以下は絶対に実行しない：
- リアルトレードモードへの切り替え
- 資金の実際の移動
- 外部への個人情報送信
- セキュリティ設定の緩和

---

## 報告フォーマット

### 実行前報告（軽量）
```
🔧 自動修正開始
- 問題: XXX
- 修正内容: YYY
```

### 実行後報告（詳細）
```
✅ 自動修正完了
- 適用した修正: N件
- 結果: 成功/失敗
- 詳細: ...
```

---

## 自律システムの範囲

### 完全自動化済み

1. **自己診断（1時間ごと）**
   - ログ分析
   - コード分析
   - 問題検出

2. **自動修正**
   - コード修正
   - 設定変更
   - プロセス再起動

3. **監視＋通知**
   - プロセス監視（5分ごと）
   - メモリ監視（5チェックごと）
   - Discord通知

---

## タスク完了後の自己診断（必須）

**原則:** どんなタスクでも、完了報告の前に必ず自己チェックを実行する

### 📋 チェックリスト

#### 1. **動作検証**
- [ ] 実装したコードが実際に動作するか確認
- [ ] エラーログに異常がないか確認
- [ ] 期待通りの出力・結果が得られているか

#### 2. **ロジック検証**
- [ ] 数値計算に矛盾がないか（資金、在庫、カウント等）
- [ ] 条件分岐が正しく動作するか
- [ ] エッジケース（0件、最大値、NULL等）を考慮しているか

#### 3. **整合性チェック**
- [ ] 設定値と実際の動作が一致しているか
- [ ] データベース/ファイルの内容が期待通りか
- [ ] 複数のデータソース間で矛盾がないか

#### 4. **リソース確認**
- [ ] メモリリークがないか
- [ ] ファイル肥大化がないか
- [ ] プロセスが正常に動作しているか

### 🔍 具体例（今回のケース）

**タスク:** Bitget自動トレーダー実装

**実行すべきだった自己チェック:**
```python
# 1. 資金の動きを確認
print(f"エントリー前の資金: ${capital}")
# エントリー実行
print(f"エントリー後の資金: ${capital}")  # ← 減っているか？

# 2. ポジション数の確認
if len(positions) > max_positions:
    print(f"⚠️ 警告: ポジション数超過（{len(positions)} > {max_positions}）")

# 3. 資金整合性チェック
total_invested = sum(p['position_size'] for p in positions.values())
if capital + total_invested != initial_capital + total_pnl:
    print(f"⚠️ 警告: 資金計算が不整合")
```

### 📊 報告時の追加情報

完了報告時に含めるべき内容：
- ✅ 正常動作の確認結果
- ⚠️ 気になる点・潜在的な問題
- 💡 今後の改善案

**悪い例:**
> 「トレーダー実装完了しましたっぴ！」

**良い例:**
> 「トレーダー実装完了しましたっぴ！
> ✅ 5銘柄監視開始
> ✅ エントリー・エグジット動作確認済み
> ⚠️ 資金管理ロジックを確認したところ、エントリー時に資金が減っていません。修正が必要かもしれません。」

### 🚨 問題発見時の対応

1. **即座に報告** - 隠さない、後回しにしない
2. **影響範囲を明示** - 「どのくらい深刻か」を説明
3. **修正案を提示** - 自動承認モードなら即修正

---

## 例外対応

予期しない状況が発生した場合：
1. 安全側に倒す（停止・保存・報告）
2. Discordで詳細報告
3. andoさんの指示を待つ

---

**更新履歴:**
- 2026-02-13: 初版作成（自動承認モード開始）
